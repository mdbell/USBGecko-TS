<!DOCTYPE html>
<html>

<head>
    <script src="dist/bundle.js"></script>
    <script>
        var gecko = null;
        async function connect() {
            if (gecko) {
                gecko.close();
            }
            gecko = await WebGecko.create();
        }

        async function pause() {
            if (!gecko || !gecko.connected()) {
                alert("Need to have an active connection before pausing");
                return;
            }
            await gecko.pause();
        }

        async function resume() {
            if (!gecko || !gecko.connected()) {
                alert("Need to have an active connection before resuming");
                return;
            }
            await gecko.resume();
        }

        async function pokemem() {
            if (!gecko || !gecko.connected()) {
                alert("Need to have an active connection before poking");
                return;
            }
            const address = parseInt(document.getElementById("mem_addr").value, 16);
            const value = parseInt(document.getElementById("mem_value").value);
            await gecko.poke32(address, value);
        }

        async function peekmem() {
            if (!gecko || !gecko.connected()) {
                alert("Need to have an active connection before peeking");
                return;
            }
            const address = parseInt(document.getElementById("mem_addr").value, 16);
            const value = await gecko.peek32(address);
            document.getElementById("mem_value").value = value;
        }

        async function step() {
            if (!gecko || !gecko.connected()) {
                alert("Need to have an active connection before stepping");
                return;
            }
            await gecko.step();
        }

        async function dumpScreen() {
            if (!gecko || !gecko.connected()) {
                alert("You need to have an active gecko connection!")
                return;
            }
            await gecko.pause();
            let img = await WebGecko.getScreenData(gecko);
            let canvas = document.getElementById('screen');
            canvas.width = img.width;
            canvas.height = img.height;
            canvas.getContext('2d').putImageData(img, 0, 0);
            await gecko.resume();
        }
    </script>
</head>

<body>
    <button onclick="connect()">Connect</button>
    <button onclick="pause()">Pause</button>
    <button onclick="resume()">Resume</button>
    <button onclick="step()">Step</button>
    <hr/>
    <label>Address:</label>
    <input type="text" id="mem_addr" name="mem_addr" pattern="#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?" maxlength="8" value="80578A04" /><br />
    <label>Value:</label>
    <input type="number" id="mem_value" name="mem_value" /><br />
    <button onclick="pokemem()">Poke32</button>
    <button onclick="peekmem()">Peek32</button>
    <hr />
    <button onclick="dumpScreen()">Screenshot</button> <br/>
    <canvas width="365" height="463" id="screen" />
</body>

</html>